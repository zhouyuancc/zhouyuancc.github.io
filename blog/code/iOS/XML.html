<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="1404.34">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 8.0px 0.0px; font: 18.0px Helvetica; color: #595959}
    p.p2 {margin: 0.0px 0.0px 8.0px 0.0px; font: 18.0px 'STHeiti Light'; color: #595959}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px Helvetica; color: #595959}
    p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px 'STHeiti Light'; color: #595959; min-height: 18.0px}
    p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 16.0px 'STHeiti Light'; color: #595959}
    p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 16.0px Menlo}
    p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px 'STHeiti Light'; color: #595959}
    p.p8 {margin: 0.0px 0.0px 0.0px 0.0px; font: 32.0px Helvetica; color: #4f81bd}
    p.p9 {margin: 0.0px 0.0px 8.0px 0.0px; font: 18.0px 'STHeiti Light'; color: #595959; background-color: #e0edd4}
    p.p10 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px Menlo; color: #aa2391}
    p.p11 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px Helvetica; color: #595959; min-height: 22.0px}
    p.p12 {margin: 0.0px 0.0px 8.0px 0.0px; font: 18.0px Helvetica; color: #595959; background-color: #e0edd4}
    p.p13 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px Helvetica; color: #595959; background-color: #e0edd4}
    p.p14 {margin: 0.0px 0.0px 8.0px 0.0px; font: 18.0px Menlo; color: #c41b17}
    p.p15 {margin: 0.0px 0.0px 8.0px 0.0px; font: 18.0px Menlo; color: #836c27}
    p.p16 {margin: 0.0px 0.0px 8.0px 0.0px; font: 18.0px Helvetica; color: #595959; min-height: 22.0px}
    p.p17 {margin: 0.0px 0.0px 8.0px 0.0px; font: 18.0px Menlo; color: #aa2391}
    p.p18 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px Menlo; color: #aa2391; min-height: 21.0px}
    p.p19 {margin: 0.0px 0.0px 0.0px 0.0px; font: 16.0px 'STHeiti Light'; color: #595959; min-height: 16.0px}
    p.p20 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px Menlo; color: #1d9421}
    p.p21 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px Menlo; min-height: 21.0px}
    p.p22 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px Menlo; color: #c91b13}
    p.p23 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px Menlo; color: #6122ae}
    p.p24 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px Menlo; color: #c32275}
    p.p25 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px Menlo}
    p.p26 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px Menlo; color: #294c50}
    p.p27 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px Menlo; background-color: #fff995}
    p.p28 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px Menlo; color: #3c828c}
    p.p29 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px Menlo; background-color: #b1dd8c}
    p.p30 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px Menlo; color: #3d1d81; background-color: #e0edd4}
    p.p31 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px Menlo; color: #822e0e}
    p.p32 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px 'PingFang SC'; color: #1d9421}
    p.p33 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px Menlo; color: #1d9421; min-height: 21.0px}
    p.p34 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px Menlo; background-color: #e0edd4}
    span.s1 {font: 18.0px 'STHeiti Light'; font-kerning: none; font-variant-ligatures: no-common-ligatures}
    span.s2 {font-kerning: none; font-variant-ligatures: no-common-ligatures}
    span.s3 {font-kerning: none; font-variant-ligatures: no-common-ligatures; color: #ff2500}
    span.s4 {font: 18.0px Helvetica; font-kerning: none; font-variant-ligatures: no-common-ligatures}
    span.s5 {font: 18.0px 'STHeiti Light'; font-kerning: none; font-variant-ligatures: no-common-ligatures; background-color: #fff995}
    span.s6 {font: 16.0px Menlo; font-kerning: none; font-variant-ligatures: no-common-ligatures; color: #000000}
    span.s7 {font-kerning: none; font-variant-ligatures: no-common-ligatures; color: #aa2391}
    span.s8 {font-kerning: none; font-variant-ligatures: no-common-ligatures; color: #5c2699}
    span.s9 {font: 18.0px 'STHeiti Light'; font-kerning: none; font-variant-ligatures: no-common-ligatures; color: #595959}
    span.s10 {font-kerning: none; font-variant-ligatures: no-common-ligatures; background-color: #fff995}
    span.s11 {font: 32.0px 'PingFang SC'; font-kerning: none; font-variant-ligatures: no-common-ligatures}
    span.s12 {font-kerning: none; font-variant-ligatures: no-common-ligatures; color: #c41b17}
    span.s13 {font-kerning: none; font-variant-ligatures: no-common-ligatures; color: #836c27}
    span.s14 {font: 18.0px Menlo; font-kerning: none; font-variant-ligatures: no-common-ligatures; color: #c41b17}
    span.s15 {font-kerning: none; font-variant-ligatures: no-common-ligatures; color: #000000}
    span.s16 {font: 18.0px 'STHeiti Light'; font-kerning: none; font-variant-ligatures: no-common-ligatures; color: #000000}
    span.s17 {font: 16.0px Helvetica; font-kerning: none; font-variant-ligatures: no-common-ligatures; background-color: #e0edd4}
    span.s18 {font-kerning: none; font-variant-ligatures: no-common-ligatures; background-color: #e0edd4}
    span.s19 {font: 16.0px Helvetica; font-kerning: none; font-variant-ligatures: no-common-ligatures}
    span.s20 {font-variant-ligatures: no-common-ligatures}
    span.s21 {font: 18.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures}
    span.s22 {font-variant-ligatures: no-common-ligatures; color: #822e0e}
    span.s23 {font-variant-ligatures: no-common-ligatures; color: #c32275}
    span.s24 {font-variant-ligatures: no-common-ligatures; color: #000000}
    span.s25 {font-variant-ligatures: no-common-ligatures; color: #3c828c}
    span.s26 {font-variant-ligatures: no-common-ligatures; color: #6122ae}
    span.s27 {font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures; color: #000000}
    span.s28 {font: 18.0px Helvetica; font-kerning: none; font-variant-ligatures: no-common-ligatures; color: #0433ff}
    span.s29 {font: 18.0px 'PingFang SC'; font-kerning: none; font-variant-ligatures: no-common-ligatures; color: #0433ff}
    span.s30 {font-variant-ligatures: no-common-ligatures; color: #3d1d81}
    span.s31 {font-variant-ligatures: no-common-ligatures; color: #294c50}
    span.s32 {font-variant-ligatures: no-common-ligatures; color: #0435ff}
    span.s33 {font-variant-ligatures: no-common-ligatures; color: #c91b13}
    span.s34 {font-variant-ligatures: no-common-ligatures; color: #539aa4}
    span.s35 {font-variant-ligatures: no-common-ligatures; color: #703daa}
    span.s36 {font: 18.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #000000}
    span.s37 {font-variant-ligatures: no-common-ligatures; color: #1d9421}
    span.s38 {font: 18.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #1d9421}
    span.s39 {font: 18.0px Menlo; font-variant-ligatures: no-common-ligatures}
    span.s40 {font-variant-ligatures: no-common-ligatures; background-color: #fff995}
    span.s41 {font: 18.0px 'PingFang SC'; font-variant-ligatures: no-common-ligatures; color: #c91b13}
  </style>
</head>
<body>
<p class="p1"><span class="s1">什么是</span><span class="s2">XML</span></p>
<p class="p1"><span class="s1">全称是</span><span class="s2">E</span><span class="s3">x</span><span class="s2">tensible </span><span class="s3">M</span><span class="s2">arkup </span><span class="s3">L</span><span class="s2">anguage</span><span class="s1">，译作</span><span class="s2">“</span><span class="s1">可扩展标记语言</span><span class="s2">”</span></p>
<p class="p2"><span class="s2">跟</span><span class="s4">JSON</span><span class="s2">一样，也是常用的一种用于交互的数据格式</span></p>
<p class="p3"><span class="s1">一般也叫</span><span class="s2">XML</span><span class="s1">文档（</span><span class="s2">XML Document</span><span class="s1">）</span></p>
<p class="p4"><span class="s2"></span><br></p>
<p class="p5"><span class="s1">大文件解析用</span><span class="s5">SAX</span><span class="s1">（一个个遍历，需要代理，</span><span class="s2">当扫描到元素的开始时调用（</span><span class="s6">attributeDict</span><span class="s2">存放着元素的属性）</span></p>
<p class="p6"><span class="s2">- (</span><span class="s7">void</span><span class="s2">)parser:(</span><span class="s8">NSXMLParser</span><span class="s2"> *)parser didStartElement:(</span><span class="s8">NSString</span><span class="s2"> *)elementName namespaceURI:(</span><span class="s8">NSString</span><span class="s2"> *)namespaceURI qualifiedName:(</span><span class="s8">NSString</span><span class="s2"> *)qName attributes:(</span><span class="s8">NSDictionary</span><span class="s2"> *)attributeDict</span><span class="s9">）<span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s2"></span><br></p>
<p class="p7"><span class="s2">小文件</span><span class="s10">DOM</span><span class="s2">（一次全部取到数据）</span></p>
<p class="p4"><span class="s2"></span><br></p>
<p class="p8"><span class="s2">XML</span><span class="s11">语法</span></p>
<p class="p2"><span class="s2">一个常见的</span><span class="s4">XML</span><span class="s2">文档一般由以下部分组成</span></p>
<p class="p9"><span class="s2">文档声明</span></p>
<p class="p10"><span class="s2">&lt;?xml version=</span><span class="s12">"1.0"</span><span class="s2"> encoding=</span><span class="s12">"UTF-8"</span><span class="s2"> ?&gt;</span></p>
<p class="p11"><span class="s2"></span><br></p>
<p class="p12"><span class="s1">元素（</span><span class="s2">Element</span><span class="s1">）</span></p>
<p class="p13"><span class="s1">属性（</span><span class="s2">Attribute</span><span class="s1">）</span></p>
<p class="p4"><span class="s2"></span><br></p>
<p class="p2"><span class="s2">一个元素可以拥有多个属性</span></p>
<p class="p14"><span class="s7">&lt;video </span><span class="s13">name</span><span class="s7">=</span><span class="s2">"</span><span class="s1">小黄人</span><span class="s2"> </span><span class="s1">第</span><span class="s2">01</span><span class="s1">部</span><span class="s2">"</span><span class="s7"> </span><span class="s13">length</span><span class="s7">=</span><span class="s2">"30"</span><span class="s7"> /&gt;</span></p>
<p class="p15"><span class="s7">video</span><span class="s9">元素拥有</span><span class="s2">name</span><span class="s9">和</span><span class="s2">length</span><span class="s9">两个属性</span></p>
<p class="p2"><span class="s2">属性值必须用 双引号</span><span class="s14">"" </span><span class="s2">或者 单引号</span><span class="s14">'' </span><span class="s2">括住</span></p>
<p class="p16"><span class="s2"></span><br></p>
<p class="p2"><span class="s2">实际上，属性表示的信息也可以用子元素来表示，比如</span></p>
<p class="p17"><span class="s2">&lt;video&gt;</span></p>
<p class="p17"><span class="s15"><span class="Apple-converted-space">    </span></span><span class="s2">&lt;name&gt;</span><span class="s16">小黄人</span><span class="s15"> </span><span class="s16">第</span><span class="s15">01</span><span class="s16">部</span><span class="s2">&lt;/name&gt;</span></p>
<p class="p17"><span class="s15"><span class="Apple-converted-space">        </span></span><span class="s2">&lt;length&gt;</span><span class="s15">30</span><span class="s2">&lt;/length&gt;</span></p>
<p class="p10"><span class="s2">&lt;/video&gt;</span></p>
<p class="p18"><span class="s2"></span><br></p>
<p class="p5"><span class="s2">相比之下，</span><span class="s17">JSON</span><span class="s18">的体积小于</span><span class="s17">XML</span><span class="s2">，所以服务器返回给移动端的数据格式以</span><span class="s19">JSON</span><span class="s2">居多</span></p>
<p class="p19"><span class="s2"></span><br></p>
<p class="p5"><span class="s2">————————————————————————————————————————————————————————————————</span></p>
<p class="p20"><span class="s20">//</span></p>
<p class="p20"><span class="s20">//<span class="Apple-converted-space">  </span>HMVideoTool.m</span></p>
<p class="p20"><span class="s20">//<span class="Apple-converted-space">  </span>02-</span><span class="s21">黑酷</span><span class="s20">(XML</span><span class="s21">解析</span><span class="s20">)</span></p>
<p class="p20"><span class="s20">//</span></p>
<p class="p20"><span class="s20">//<span class="Apple-converted-space">  </span>Created by apple on 14-6-27.</span></p>
<p class="p20"><span class="s20">//<span class="Apple-converted-space">  </span>Copyright (c) 2014</span><span class="s21">年</span><span class="s20"> heima. All rights reserved.</span></p>
<p class="p20"><span class="s20">//</span></p>
<p class="p21"><span class="s20"></span><br></p>
<p class="p22"><span class="s22">#import </span><span class="s20">"HMVideoTool.h"</span></p>
<p class="p22"><span class="s22">#import </span><span class="s20">"HMVideo.h"</span></p>
<p class="p22"><span class="s22">#import </span><span class="s20">"GDataXMLNode.h"</span></p>
<p class="p21"><span class="s20"></span><br></p>
<p class="p23"><span class="s23">@interface</span><span class="s24"> </span><span class="s25">HMVideoTool</span><span class="s24">() &lt;</span><span class="s20">NSXMLParserDelegate</span><span class="s24">&gt;</span></p>
<p class="p24"><span class="s20">@property</span><span class="s24"> (</span><span class="s20">nonatomic</span><span class="s24">, </span><span class="s20">strong</span><span class="s24">) </span><span class="s26">NSMutableArray</span><span class="s24"> *videos;</span></p>
<p class="p24"><span class="s20">@end</span></p>
<p class="p21"><span class="s20"></span><br></p>
<p class="p24"><span class="s20">@implementation</span><span class="s24"> HMVideoTool</span></p>
<p class="p21"><span class="s20"></span><br></p>
<p class="p25"><span class="s20">- (</span><span class="s26">NSArray</span><span class="s20"> *)parseXMLData:(</span><span class="s26">NSData</span><span class="s20"> *)data</span></p>
<p class="p25"><span class="s20">{</span></p>
<p class="p26"><span class="s24"><span class="Apple-converted-space">    </span></span><span class="s23">return</span><span class="s24"> [</span><span class="s23">self</span><span class="s24"> </span><span class="s20">DOMparseXMLWithData</span><span class="s24">:data];</span></p>
<p class="p25"><span class="s20">}</span></p>
<p class="p21"><span class="s20"></span><br></p>
<p class="p25"><span class="s20">&lt;videos&gt;</span></p>
<p class="p25"><span class="s20"><span class="Apple-converted-space"> </span>&lt;videos id=‘1’ length=‘5’ name=‘name1’ image=‘’ url=‘’/&gt;</span></p>
<p class="p25"><span class="s20"><span class="Apple-converted-space"> </span>&lt;videos id=‘2’ length=‘5’ name=‘name2’ image=‘’ url=‘’/&gt;</span></p>
<p class="p25"><span class="s20"><span class="Apple-converted-space"> </span>&lt;videos id=‘3’ length=‘5’ name=‘name3’ image=‘’ url=‘’/&gt;</span></p>
<p class="p25"><span class="s20">&lt;videos&gt;</span></p>
<p class="p21"><span class="s20"></span><br></p>
<p class="p7"><span class="s27">//</span><span class="s2">小文件（一次全部取到数据）一次性将整个</span><span class="s4">XML</span><span class="s2">文档加载进内存，比较适合解析</span><span class="s3">小</span><span class="s2">文件</span></p>
<p class="p7"><span class="s2">//DOM需要</span><span class="s28">libxml2</span><span class="s29">框架，</span><span class="s2">调用GDataXMLNode.h GDataXMLNode.m文件，设置这两个文件为非ARC模式</span></p>
<p class="p27"><span class="s20">- (</span><span class="s26">NSArray</span><span class="s20"> *)DOMparseXMLWithData:(</span><span class="s26">NSData</span><span class="s20"> *)data</span></p>
<p class="p25"><span class="s20">{</span></p>
<p class="p20"><span class="s24"><span class="Apple-converted-space">    </span></span><span class="s20">// 1.</span><span class="s21">加载文档</span></p>
<p class="p28"><span class="s24"><span class="Apple-converted-space">    </span></span><span class="s20">GDataXMLDocument</span><span class="s24"> *doc = [[</span><span class="s20">GDataXMLDocument</span><span class="s24"> </span><span class="s30">alloc</span><span class="s24">] </span><span class="s31">initWithData</span><span class="s24">:data </span><span class="s31">options</span><span class="s24">:</span><span class="s32">0</span><span class="s24"> </span><span class="s31">error</span><span class="s24">:</span><span class="s23">nil</span><span class="s24">];</span></p>
<p class="p21"><span class="s20"><span class="Apple-converted-space">    </span></span></p>
<p class="p20"><span class="s24"><span class="Apple-converted-space">    </span></span><span class="s20">// 2.</span><span class="s21">获得根元素</span></p>
<p class="p25"><span class="s20"><span class="Apple-converted-space">    </span></span><span class="s25">GDataXMLElement</span><span class="s20"> *root = doc.</span><span class="s31">rootElement</span><span class="s20">;</span></p>
<p class="p21"><span class="s20"><span class="Apple-converted-space">    </span></span></p>
<p class="p20"><span class="s24"><span class="Apple-converted-space">    </span></span><span class="s20">// 3.</span><span class="s21">获得所有</span><span class="s20">video</span><span class="s21">元素</span></p>
<p class="p25"><span class="s20"><span class="Apple-converted-space">    </span></span><span class="s26">NSArray</span><span class="s20"> *elements = [root </span><span class="s31">elementsForName</span><span class="s20">:</span><span class="s33">@"video"</span><span class="s20">];</span></p>
<p class="p21"><span class="s20"><span class="Apple-converted-space">    </span></span></p>
<p class="p20"><span class="s24"><span class="Apple-converted-space">    </span></span><span class="s20">// 4.</span><span class="s21">将</span><span class="s20">GDataXMLElement</span><span class="s21">对象转成</span><span class="s20">HMVideo</span><span class="s21">模型</span></p>
<p class="p23"><span class="s24"><span class="Apple-converted-space">    </span></span><span class="s20">NSMutableArray</span><span class="s24"> *videos = [</span><span class="s20">NSMutableArray</span><span class="s24"> </span><span class="s30">array</span><span class="s24">];</span></p>
<p class="p25"><span class="s20"><span class="Apple-converted-space">    </span></span><span class="s23">for</span><span class="s20"> (</span><span class="s25">GDataXMLElement</span><span class="s20"> *ele </span><span class="s23">in</span><span class="s20"> elements) {</span></p>
<p class="p25"><span class="s20"><span class="Apple-converted-space">        </span></span><span class="s25">HMVideo</span><span class="s20"> *video = [[</span><span class="s25">HMVideo</span><span class="s20"> </span><span class="s30">alloc</span><span class="s20">] </span><span class="s30">init</span><span class="s20">];</span></p>
<p class="p25"><span class="s20"><span class="Apple-converted-space">        </span>video.</span><span class="s34">ID</span><span class="s20"> = [ele </span><span class="s31">attributeForName</span><span class="s20">:</span><span class="s33">@"id"</span><span class="s20">].</span><span class="s31">stringValue</span><span class="s20">.</span><span class="s35">intValue</span><span class="s20">;</span></p>
<p class="p25"><span class="s20"><span class="Apple-converted-space">        </span>video.</span><span class="s34">length</span><span class="s20"> = [ele </span><span class="s31">attributeForName</span><span class="s20">:</span><span class="s33">@"length"</span><span class="s20">].</span><span class="s31">stringValue</span><span class="s20">.</span><span class="s35">intValue</span><span class="s20">;</span></p>
<p class="p26"><span class="s24"><span class="Apple-converted-space">        </span>video.</span><span class="s34">name</span><span class="s24"> = [ele </span><span class="s20">attributeForName</span><span class="s24">:</span><span class="s33">@"name"</span><span class="s24">].</span><span class="s20">stringValue</span><span class="s24">;</span></p>
<p class="p26"><span class="s24"><span class="Apple-converted-space">        </span>video.</span><span class="s34">image</span><span class="s24"> = [ele </span><span class="s20">attributeForName</span><span class="s24">:</span><span class="s33">@"image"</span><span class="s24">].</span><span class="s20">stringValue</span><span class="s24">;</span></p>
<p class="p26"><span class="s24"><span class="Apple-converted-space">        </span>video.</span><span class="s34">url</span><span class="s24"> = [ele </span><span class="s20">attributeForName</span><span class="s24">:</span><span class="s33">@"url"</span><span class="s24">].</span><span class="s20">stringValue</span><span class="s24">;</span></p>
<p class="p25"><span class="s20"><span class="Apple-converted-space">        </span>[videos </span><span class="s30">addObject</span><span class="s20">:video];</span></p>
<p class="p25"><span class="s20"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p25"><span class="s20"><span class="Apple-converted-space">    </span></span><span class="s23">return</span><span class="s20"> videos;</span></p>
<p class="p25"><span class="s20">}</span></p>
<p class="p21"><span class="s20"></span><br></p>
<p class="p7"><span class="s36">//</span><span class="s2">大文件解析（一个个遍历，需要代理）从根元素开始，按顺序一个元素一个元素往下解析，比较适合解析</span><span class="s3">大</span><span class="s2">文件</span></p>
<p class="p27"><span class="s20">- (</span><span class="s26">NSArray</span><span class="s20"> *)SAXparseXMLWithData:(</span><span class="s26">NSData</span><span class="s20"> *)data</span></p>
<p class="p25"><span class="s20">{</span></p>
<p class="p20"><span class="s24"><span class="Apple-converted-space">    </span></span><span class="s20">// 1.</span><span class="s21">创建解析器</span></p>
<p class="p25"><span class="s20"><span class="Apple-converted-space">    </span></span><span class="s26">NSXMLParser</span><span class="s20"> *parser = [[</span><span class="s26">NSXMLParser</span><span class="s20"> </span><span class="s30">alloc</span><span class="s20">] </span><span class="s30">initWithData</span><span class="s20">:data];</span></p>
<p class="p21"><span class="s20"><span class="Apple-converted-space">    </span></span></p>
<p class="p20"><span class="s24"><span class="Apple-converted-space">    </span></span><span class="s20">// 2.</span><span class="s21">设置代理</span></p>
<p class="p25"><span class="s20"><span class="Apple-converted-space">    </span>parser.</span><span class="s35">delegate</span><span class="s20"> = </span><span class="s23">self</span><span class="s20">;</span></p>
<p class="p21"><span class="s20"><span class="Apple-converted-space">    </span></span></p>
<p class="p20"><span class="s24"><span class="Apple-converted-space">    </span></span><span class="s20">// 3.</span><span class="s21">开始解析</span></p>
<p class="p25"><span class="s20"><span class="Apple-converted-space">    </span>[parser </span><span class="s30">parse</span><span class="s20">]; </span><span class="s37">// </span><span class="s38">卡住</span><span class="s37">(</span><span class="s38">解析完毕才会返回</span><span class="s37">)</span></p>
<p class="p21"><span class="s20"><span class="Apple-converted-space">    </span></span></p>
<p class="p24"><span class="s24"><span class="Apple-converted-space">    </span></span><span class="s20">return</span><span class="s24"> </span><span class="s20">self</span><span class="s24">.</span><span class="s34">videos</span><span class="s24">;</span></p>
<p class="p25"><span class="s20">}</span></p>
<p class="p21"><span class="s20"></span><br></p>
<p class="p29"><span class="s20">- (</span><span class="s26">NSArray</span><span class="s20"> *)parseJSONData:(</span><span class="s26">NSData</span><span class="s20"> *)data</span></p>
<p class="p25"><span class="s20">{</span></p>
<p class="p20"><span class="s24"><span class="Apple-converted-space">    </span></span><span class="s20">// </span><span class="s21">解析数据</span></p>
<p class="p30"><span class="s24"><span class="Apple-converted-space">    </span></span><span class="s26">NSDictionary</span><span class="s24"> *dict = [</span><span class="s26">NSJSONSerialization</span><span class="s24"> </span><span class="s20">JSONObjectWithData</span><span class="s24">:data </span><span class="s20">options</span><span class="s24">:</span><span class="s20">NSJSONReadingMutableLeaves</span><span class="s24"> </span><span class="s20">error</span><span class="s24">:</span><span class="s23">nil</span><span class="s24">];</span></p>
<p class="p25"><span class="s20"><span class="Apple-converted-space">    </span></span><span class="s26">NSArray</span><span class="s20"> *array = dict[</span><span class="s33">@"videos"</span><span class="s20">];</span></p>
<p class="p21"><span class="s20"><span class="Apple-converted-space">    </span></span></p>
<p class="p23"><span class="s24"><span class="Apple-converted-space">    </span></span><span class="s20">NSMutableArray</span><span class="s24"> *videos = [</span><span class="s20">NSMutableArray</span><span class="s24"> </span><span class="s30">array</span><span class="s24">];</span></p>
<p class="p25"><span class="s20"><span class="Apple-converted-space">    </span></span><span class="s23">for</span><span class="s20"> (</span><span class="s26">NSDictionary</span><span class="s20"> *videoDict </span><span class="s23">in</span><span class="s20"> array) {</span></p>
<p class="p25"><span class="s20"><span class="Apple-converted-space">        </span></span><span class="s25">HMVideo</span><span class="s20"> *video = [</span><span class="s25">HMVideo</span><span class="s20"> </span><span class="s31">videoWithDict</span><span class="s20">:videoDict];</span></p>
<p class="p25"><span class="s20"><span class="Apple-converted-space">        </span>[videos </span><span class="s30">addObject</span><span class="s20">:video];</span></p>
<p class="p25"><span class="s20"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p25"><span class="s20"><span class="Apple-converted-space">    </span></span><span class="s23">return</span><span class="s20"> videos;</span></p>
<p class="p25"><span class="s20">}</span></p>
<p class="p21"><span class="s20"></span><br></p>
<p class="p31"><span class="s20">#pragma mark - NSXMLParserDelegate</span></p>
<p class="p20"><span class="s20">/**</span></p>
<p class="p32"><span class="s39"><span class="Apple-converted-space"> </span>*<span class="Apple-converted-space">  </span></span><span class="s20">开始解析文档时调用</span></p>
<p class="p20"><span class="s20"><span class="Apple-converted-space"> </span>*/</span></p>
<p class="p25"><span class="s20">- (</span><span class="s23">void</span><span class="s20">)parserDidStartDocument:(</span><span class="s26">NSXMLParser</span><span class="s20"> *)parser</span></p>
<p class="p25"><span class="s20">{</span></p>
<p class="p20"><span class="s24"><span class="Apple-converted-space">    </span></span><span class="s20">//<span class="Apple-converted-space">    </span>NSLog(@"parserDidStartDocument----");</span></p>
<p class="p25"><span class="s20">}</span></p>
<p class="p20"><span class="s20">/**</span></p>
<p class="p32"><span class="s39"><span class="Apple-converted-space"> </span>*<span class="Apple-converted-space">  </span></span><span class="s40">结束解析文档时调用</span><span class="s39">(</span><span class="s20">解析完毕</span><span class="s39">)</span></p>
<p class="p20"><span class="s20"><span class="Apple-converted-space"> </span>*/</span></p>
<p class="p27"><span class="s20">- (</span><span class="s23">void</span><span class="s20">)parserDidEndDocument:(</span><span class="s26">NSXMLParser</span><span class="s20"> *)parser</span></p>
<p class="p25"><span class="s20">{</span></p>
<p class="p20"><span class="s24"><span class="Apple-converted-space">    </span></span><span class="s20">//<span class="Apple-converted-space">    </span>NSLog(@"parserDidEndDocument----");</span></p>
<p class="p25"><span class="s20">}</span></p>
<p class="p21"><span class="s20"></span><br></p>
<p class="p20"><span class="s20">/**</span></p>
<p class="p20"><span class="s20"><span class="Apple-converted-space"> </span>*<span class="Apple-converted-space">  </span></span><span class="s21">解析到一个元素的开头时调用</span><span class="s20"> &lt;videos&gt;</span></p>
<p class="p20"><span class="s20"><span class="Apple-converted-space"> </span>*/</span></p>
<p class="p27"><span class="s20">- (</span><span class="s23">void</span><span class="s20">)parser:(</span><span class="s26">NSXMLParser</span><span class="s20"> *)parser didStartElement:(</span><span class="s26">NSString</span><span class="s20"> *)elementName namespaceURI:(</span><span class="s26">NSString</span><span class="s20"> *)namespaceURI qualifiedName:(</span><span class="s26">NSString</span><span class="s20"> *)qName attributes:(</span><span class="s26">NSDictionary</span><span class="s20"> *)attributeDict</span></p>
<p class="p25"><span class="s20">{</span></p>
<p class="p20"><span class="s24"><span class="Apple-converted-space">    </span></span><span class="s20">//<span class="Apple-converted-space">    </span>NSLog(@"didStartElement----%@", elementName);</span></p>
<p class="p25"><span class="s20"><span class="Apple-converted-space">    </span></span><span class="s23">if</span><span class="s20"> ([</span><span class="s33">@"videos"</span><span class="s20"> </span><span class="s30">isEqualToString</span><span class="s20">:elementName]) { </span><span class="s37">// </span><span class="s38">解析到一个</span><span class="s37">videos</span><span class="s38">标签</span></p>
<p class="p25"><span class="s20"><span class="Apple-converted-space">        </span></span><span class="s23">self</span><span class="s20">.</span><span class="s34">videos</span><span class="s20"> = [</span><span class="s26">NSMutableArray</span><span class="s20"> </span><span class="s30">array</span><span class="s20">];</span></p>
<p class="p25"><span class="s20"><span class="Apple-converted-space">    </span>} </span><span class="s23">else</span><span class="s20"> </span><span class="s23">if</span><span class="s20"> ([</span><span class="s33">@"video"</span><span class="s20"> </span><span class="s30">isEqualToString</span><span class="s20">:elementName]) { </span><span class="s37">// </span><span class="s38">解析到一个</span><span class="s37">video</span><span class="s38">标签</span><span class="s37">, </span><span class="s38">创建一个模型</span></p>
<p class="p25"><span class="s20"><span class="Apple-converted-space">        </span></span><span class="s25">HMVideo</span><span class="s20"> *video = [</span><span class="s25">HMVideo</span><span class="s20"> </span><span class="s31">videoWithDict</span><span class="s20">:attributeDict];</span></p>
<p class="p25"><span class="s20"><span class="Apple-converted-space">        </span>[</span><span class="s23">self</span><span class="s20">.</span><span class="s34">videos</span><span class="s20"> </span><span class="s30">addObject</span><span class="s20">:video];</span></p>
<p class="p25"><span class="s20"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p25"><span class="s20">}</span></p>
<p class="p21"><span class="s20"></span><br></p>
<p class="p20"><span class="s20">/**</span></p>
<p class="p20"><span class="s20"><span class="Apple-converted-space"> </span>*<span class="Apple-converted-space">  </span></span><span class="s21">解析到一个元素的结尾时调用</span><span class="s20"> &lt;/videos&gt;</span></p>
<p class="p20"><span class="s20"><span class="Apple-converted-space"> </span>*/</span></p>
<p class="p25"><span class="s20">- (</span><span class="s23">void</span><span class="s20">)parser:(</span><span class="s26">NSXMLParser</span><span class="s20"> *)parser didEndElement:(</span><span class="s26">NSString</span><span class="s20"> *)elementName namespaceURI:(</span><span class="s26">NSString</span><span class="s20"> *)namespaceURI qualifiedName:(</span><span class="s26">NSString</span><span class="s20"> *)qName</span></p>
<p class="p25"><span class="s20">{</span></p>
<p class="p20"><span class="s24"><span class="Apple-converted-space">    </span></span><span class="s20">//<span class="Apple-converted-space">    </span>NSLog(@"didEndElement----%@", elementName);</span></p>
<p class="p25"><span class="s20">}</span></p>
<p class="p21"><span class="s20"></span><br></p>
<p class="p24"><span class="s20">@end</span></p>
<p class="p19"><span class="s2"></span><br></p>
<p class="p5"><span class="s2">————调用————————————————————————————————————————————————————————————</span></p>
<p class="p20"><span class="s20">//</span></p>
<p class="p20"><span class="s20">//<span class="Apple-converted-space">  </span>HMViewController.m</span></p>
<p class="p20"><span class="s20">//<span class="Apple-converted-space">  </span>05-</span><span class="s21">黑酷</span></p>
<p class="p20"><span class="s20">//</span></p>
<p class="p20"><span class="s20">//<span class="Apple-converted-space">  </span>Created by apple on 14-6-26.</span></p>
<p class="p20"><span class="s20">//<span class="Apple-converted-space">  </span>Copyright (c) 2014</span><span class="s21">年</span><span class="s20"> heima. All rights reserved.</span></p>
<p class="p20"><span class="s20">//</span></p>
<p class="p33"><span class="s20"></span><br></p>
<p class="p25"><span class="s20"><span class="Apple-converted-space">    </span>[</span><span class="s26">NSURLConnection</span><span class="s20"> </span><span class="s30">sendAsynchronousRequest</span><span class="s20">:request </span><span class="s30">queue</span><span class="s20">:[</span><span class="s26">NSOperationQueue</span><span class="s20"> </span><span class="s30">mainQueue</span><span class="s20">] </span><span class="s30">completionHandler</span><span class="s20">:^(</span><span class="s26">NSURLResponse</span><span class="s20"> *response, </span><span class="s26">NSData</span><span class="s20"> *data, </span><span class="s26">NSError</span><span class="s20"> *connectionError) {</span></p>
<p class="p25"><span class="s20"><span class="Apple-converted-space">        </span></span><span class="s37">// </span><span class="s38">隐藏</span></p>
<p class="p28"><span class="s24"><span class="Apple-converted-space">        </span>[</span><span class="s20">MBProgressHUD</span><span class="s24"> </span><span class="s31">hideHUD</span><span class="s24">];</span></p>
<p class="p21"><span class="s20"><span class="Apple-converted-space">        </span></span></p>
<p class="p25"><span class="s20"><span class="Apple-converted-space">        </span></span><span class="s23">if</span><span class="s20"> (data) {</span></p>
<p class="p20"><span class="s24"><span class="Apple-converted-space">            </span></span><span class="s20">// </span><span class="s21">解析数据</span><span class="s20"> data : XML</span><span class="s21">数据</span></p>
<p class="p25"><span class="s20"><span class="Apple-converted-space">            </span></span><span class="s25">HMVideoTool</span><span class="s20"> *tool = [[</span><span class="s25">HMVideoTool</span><span class="s20"> </span><span class="s30">alloc</span><span class="s20">] </span><span class="s30">init</span><span class="s20">];</span></p>
<p class="p34"><span class="s20"><span class="Apple-converted-space">            </span></span><span class="s23">self</span><span class="s20">.</span><span class="s34">videos</span><span class="s20"> = [tool </span><span class="s31">parseXMLData</span><span class="s20">:data];</span></p>
<p class="p25"><span class="s20"><span class="Apple-converted-space">            </span></span><span class="s37">// </span><span class="s38">刷新表格</span></p>
<p class="p25"><span class="s20"><span class="Apple-converted-space">            </span>[</span><span class="s23">self</span><span class="s20">.</span><span class="s35">tableView</span><span class="s20"> </span><span class="s30">reloadData</span><span class="s20">];</span></p>
<p class="p25"><span class="s20"><span class="Apple-converted-space">        </span>} </span><span class="s23">else</span><span class="s20"> {</span></p>
<p class="p25"><span class="s20"><span class="Apple-converted-space">            </span>[</span><span class="s25">MBProgressHUD</span><span class="s20"> </span><span class="s31">showError</span><span class="s20">:</span><span class="s33">@"</span><span class="s41">网络繁忙</span><span class="s33">!!!"</span><span class="s20">];</span></p>
<p class="p25"><span class="s20"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p25"><span class="s20"><span class="Apple-converted-space">    </span>}];</span></p>
<p class="p19"><span class="s2"></span><br></p>
<p class="p19"><span class="s2"></span><br></p>
</body>
</html>
